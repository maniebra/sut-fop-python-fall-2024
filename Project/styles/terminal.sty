\RequirePackage{listings}
\RequirePackage{xcolor}
\RequirePackage{tcolorbox}

% Define colors for modern code block theme (light mode)
\definecolor{term-bg}{RGB}{51, 51, 51}
\definecolor{term-frame}{RGB}{220, 220, 220}
\definecolor{term-text}{RGB}{225, 225, 225}
\definecolor{term-close}{RGB}{255, 95, 86}
\definecolor{term-minimize}{RGB}{255, 189, 46}
\definecolor{term-maximize}{RGB}{39, 201, 63}
\definecolor{term-topbar}{RGB}{235, 235, 235}
\definecolor{term-comment}{RGB}{128, 128, 128}
\definecolor{term-keyword}{RGB}{147, 49, 185}
\definecolor{term-string}{RGB}{66, 248, 59}
\definecolor{term-number}{RGB}{168, 99, 30}

% Configure listings style for code blocks
\lstdefinestyle{terminalstyle}{
    basicstyle=\ttfamily\small\color{term-text},
    backgroundcolor=\color{term-bg},
    numbers=none,
    breaklines=true,
    breakatwhitespace=true,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=4,
    captionpos=b,
    keepspaces=true,
    columns=flexible,
    frame=none,
    commentstyle=\color{term-comment},
    keywordstyle=\color{term-keyword},
    stringstyle=\color{term-string},
    numberstyle=\color{term-number},
    identifierstyle=\color{term-text}
}

% Create the code block environment
\newenvironment{terminal}{%
    \begin{latin}
        
        \begin{tcolorbox}[
            enhanced,
            arc=6pt,
            outer arc=6pt,
            colback=term-bg,
            colframe=term-frame,
            boxrule=0.5pt,
            left=8pt,
            right=8pt,
            top=25pt,
            bottom=8pt,
            before skip=5mm,
            after skip=5mm,
            left skip=5mm,
            right skip=5mm,
            overlay={
                % Clean topbar
                \fill[term-topbar] 
                (frame.north west) [rounded corners=6pt] rectangle ([yshift=-20pt]frame.north east);
                \fill[term-topbar] 
                ([yshift=-20pt]frame.north west) rectangle ([yshift=-12.5pt]frame.north east);
                
                % Window control buttons
                \fill[term-close] ([xshift=15pt, yshift=-10pt]frame.north west) circle (4pt);
                \fill[term-minimize] ([xshift=30pt, yshift=-10pt]frame.north west) circle (4pt);
                \fill[term-maximize] ([xshift=45pt, yshift=-10pt]frame.north west) circle (4pt);
                
            % Code block title
            \node[text=black!80, font=\small\sffamily] 
            at ([yshift=-10pt]frame.north) {Terminal};
            }
        ]
        \lstset{style=terminalstyle}
        }{%
    \end{tcolorbox}
    \end{latin}
}
